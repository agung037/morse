function jscw(t){var m="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgdmlld0JveD0iMCAwIDEwIDEwIj48cGF0aCBkPSJNMyAyIEwzIDggTDcgNSBaIiBzdHlsZT0iZmlsbDojZmZmO3N0cm9rZS13aWR0aDowLjM7c3Ryb2tlOiMwMDA7c3Ryb2tlLWxpbmVqb2luOmJldmVsOyIvPjwvc3ZnPgo=",s="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgdmlld0JveD0iMCAwIDEwIDEwIj48c3R5bGU+LmF7ZmlsbDojZmZmO3N0cm9rZS13aWR0aDowLjM7c3Ryb2tlOiMwMDA7fTwvc3R5bGU+PHJlY3Qgd2lkdGg9IjEuNiIgaGVpZ2h0PSI1IiB4PSIzIiB5PSIyLjUiIHJ5PSIwLjQiIGNsYXNzPSJhIi8+PHJlY3Qgd2lkdGg9IjEuNiIgaGVpZ2h0PSI1IiB4PSI1LjQiIHk9IjIuNSIgcnk9IjAuNCIgY2xhc3M9ImEiLz48L3N2Zz4K",y="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTYgMjU2IiB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiI+PHBhdGggZD0ibTEwNy43NSAyMi4xNTl2MjEuNTcxYy04LjgzNSAyLjExNy0xNy4yODYgNS42MDgtMjUuMDQgMTAuMzQ3bC0xNS4yMzQtMTUuMjM0LTI4LjYzMiAyOC42MzQgMTUuMjYgMTUuMjZjLTQuNzQ0OCA3Ljc0NDQtOC4yNDQzIDE2LjE4Ni0xMC4zNzEgMjUuMDE2aC0yMS41NzN2NDAuNDkzaDIxLjU3MWMyLjExNjEgOC44MzgyIDUuNjA3NiAxNy4yODkgMTAuMzQ3IDI1LjA0M2wtMTUuMjM0IDE1LjIzNCAyOC42MzIgMjguNjM0IDE1LjI2Mi0xNS4yNjJjNy43NDQ0IDQuNzQ0OCAxNi4xODYgOC4yNDQzIDI1LjAxNiAxMC4zNzF2MjEuNTczaDQwLjQ5M3YtMjEuNTcxYzguODM3NS0yLjExNjMgMTcuMjg4LTUuNjA3OCAyNS4wNDEtMTAuMzQ3bDE1LjIzNiAxNS4yMzYgMjguNjMyLTI4LjYzNC0xNS4yNi0xNS4yNmM0Ljc0NS03Ljc0NSA4LjI0NDUtMTYuMTg3IDEwLjM3MS0yNS4wMThoMjEuNTczdi00MC40OTNoLTIxLjU3MWMtMi4xMTYzLTguODM3NS01LjYwNzgtMTcuMjg4LTEwLjM0Ny0yNS4wNDFsMTUuMjUtMTUuMjIyLTI4LjY0LTI4LjYzNC0xNS4yNiAxNS4yNmMtNy43NDUtNC43NDUtMTYuMTg3LTguMjQ0NS0yNS4wMTgtMTAuMzcxdi0yMS41NzNoLTQwLjQ5M3ptMjAuMjQ3IDU3LjUzN2E0OC4zMDMgNDguMzAzIDAgMCAxIDQ4LjMgNDguMzA0IDQ4LjMwMyA0OC4zMDMgMCAwIDEgLTQ4LjMgNDguMyA0OC4zMDMgNDguMzAzIDAgMCAxIC00OC4zMDMgLTQ4LjMgNDguMzAzIDQ4LjMwMyAwIDAgMSA0OC4zMDMgLTQ4LjMwNHoiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2ZmZmZmZiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjgiIC8+PC9zdmc+Cgo=",o={a:".-",b:"-...",c:"-.-.",d:"-..",e:".",f:"..-.",g:"--.",h:"....",i:"..",j:".---",k:"-.-",l:".-..",m:"--",n:"-.",o:"---",p:".--.",q:"--.-",r:".-.",s:"...",t:"-",u:"..-",v:"...-",w:".--",x:"-..-",y:"-.--",z:"--..",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",0:"-----","/":"-..-.","+":".-.-.","=":"-...-","?":"..--..",".":".-.-.-",",":"--..--",":":"---...","(":"-.--.",")":"-.--.-","@":".--.-.","-":"-....-",'"':".-..-.","!":"..--.",$:"...-..-","'":".----.","`":".-----.","&":". ...",";":"-.-.-.","«":".-..-.","»":".-..-.","ä":".-.-","ß":"...--..","à":".--.-","á":".--.-","â":".-","ã":".-","å":".--.-","æ":".-.-","ç":"-.-..","è":"..-..","é":"..-..","ê":".","ë":".","ì":".---.","í":"..","î":"..","ï":"..","ð":"..--.","ñ":"--.--","ò":"---","ó":"---","ô":"---","õ":"---","ö":"---.","ø":"---.","ù":"..-","ú":"..-","û":"..-","ü":"..--","ý":"-.--","þ":".--..","ÿ":"-.--","ā":".-","ă":".-","ą":".-","ć":"-.-.","ĉ":"-.-..","ċ":"-.-.","č":"-.-.","ď":"-..","đ":"-..","ē":".","ĕ":".","ė":".","ę":".","ě":".","ĝ":"--.-.","ğ":"--.","ġ":"--.","ģ":"--.","ĥ":"----","ħ":"....","ĩ":"..","ī":"..","ĭ":"..","į":"..","ı":"..","ĳ":".. .---","ĵ":".---.","ķ":"-.-","ĸ":"-.-","ĺ":".-..","ļ":".-..","ľ":".-..","ŀ":".-..","ł":".-..","ń":"-.","ņ":"-.","ň":"-.","ŉ":"-.","ŋ":"-.","ō":"---","ŏ":"---","ő":"---","œ":"---.","ŕ":".-.","ŗ":".-.","ř":".-.","ś":"...","ŝ":"...-.","ş":"...","š":"...","ţ":"-","ť":"-","ŧ":"-","ũ":"..-","ū":"..-","ŭ":"..--","ů":"..-","ű":"..-","ų":"..-","ŵ":".--","ŷ":"-.--","Ÿ":"-.--","ź":"--..","ż":"--..","ž":"--..","ſ":"...","α":".-","β":"-...","γ":"--.","δ":"-..","ε":".","ζ":"--..","η":"....","θ":"-.-.","ι":"..","κ":"-.-","λ":".-..","μ":"--","ν":"-.","ξ":"-..-","ο":"---","π":".--.","ρ":".-.","σ":"...","τ":"-","υ":"-.--","φ":"..-.","χ":"----","ψ":"--.-","ω":".--","ς":"...","а":".-","б":"-...","в":".--","г":"--.","д":"-..","е":".","ж":"...-","з":"--..","и":"..","й":".---","к":"-.-","л":".-..","м":"--","н":"-.","о":"---","п":".--.","р":".-.","с":"...","т":"-","у":"..-","ф":"..-.","х":"....","ц":"-.-.","ч":"---.","ш":"----","щ":"--.-","ъ":"-..-","ы":"-.--","ь":"-..-","э":"..-..","ю":"..--","я":".-.-","ѐ":".","ё":".","ђ":"-.. .---","ѓ":"--. .---","є":".","ѕ":"-.. --..","і":"..","ї":"..","ј":".---","љ":".-.. .---","њ":"-. .---","ћ":"-.-.","ќ":"-.- .---","ѝ":"..","ў":"..-","џ":"-.. --..","イ":".-","い":".-","ロ":".-.-","ろ":".-.-","ハ":"-...","は":"-...","ニ":"-.-.","に":"-.-.","ホ":"-..","ほ":"-..","ヘ":".","へ":".","ト":"..-..","と":"..-..","チ":"..-.","ち":"..-.","リ":"--.","り":"--.","ヌ":"....","ぬ":"....","ル":"-.--.","る":"-.--.","ヲ":".---","を":".---","ワ":"-.-","わ":"-.-","カ":".-..","か":".-..","ヨ":"--","よ":"--","ョ":"--","ょ":"--","タ":"-.","た":"-.","レ":"---","れ":"---","ソ":"---.","そ":"---.","ツ":".--.","つ":".--.","ッ":".--.","っ":".--.","ネ":"--.-","ね":"--.-","ナ":".-.","な":".-.","ラ":"...","ら":"...","ム":"-","む":"-","ウ":"..-","う":"..-","ヰ":".-..-","ゐ":".-..-","ノ":"..--","の":"..--","オ":".-...","お":".-...","ク":"...-","く":"...-","ヤ":".--","や":".--","ャ":".--","ゃ":".--","マ":"-..-","ま":"-..-","ケ":"-.--","け":"-.--","フ":"--..","ふ":"--..","コ":"----","こ":"----","エ":"-.---","え":"-.---","テ":".-.--","て":".-.--","ア":"--.--","あ":"--.--","サ":"-.-.-","さ":"-.-.-","キ":"-.-..","き":"-.-..","ユ":"-..--","ゆ":"-..--","ュ":"-..--","ゅ":"-..--","メ":"-...-","め":"-...-","ミ":"..-.-","み":"..-.-","シ":"--.-.","し":"--.-.","ヱ":".--..","ゑ":".--..","ヒ":"--..-","ひ":"--..-","モ":"-..-.","も":"-..-.","セ":".---.","せ":".---.","ス":"---.-","す":"---.-","ン":".-.-.","ん":".-.-.","゛":"..","ガ":".-.. ..","が":".-.. ..","ギ":"-.-.. ..","ぎ":"-.-.. ..","グ":"...- ..","ぐ":"...- ..","ゲ":"-.-- ..","げ":"-.-- ..","ゴ":"---- ..","ご":"---- ..","ザ":"-.-.- ..","ざ":"-.-.- ..","ジ":"--.-. ..","じ":"--.-. ..","ズ":"---.- ..","ず":"---.- ..","ゼ":".---. ..","ぜ":".---. ..","ゾ":"---. ..","ぞ":"---. ..","ダ":"-. ..","だ":"-. ..","ヂ":"..-. ..","ぢ":"..-. ..","ヅ":".--. ..","づ":".--. ..","デ":".-.-- ..","で":".-.-- ..","ド":"..-.. ..","ど":"..-.. ..","バ":"-... ..","ば":"-... ..","ビ":"--..- ..","び":"--..- ..","ブ":"--.. ..","ぶ":"--.. ..","ベ":". ..","べ":". ..","ボ":"-.. ..","ぼ":"-.. ..","゜":"..--.","パ":"-... ..--.","ぱ":"-... ..--.","ピ":"--..- ..--.","ぴ":"--..- ..--.","プ":"--.. ..--.","ぷ":"--.. ..--.","ペ":". ..--.","ぺ":". ..--.","ポ":"-.. ..--.","ぽ":"-.. ..--.","－":".--.-","ー":".--.-","（":"-.--.-","）":".-..-.","、":".-.-.-","」":".-.-..","א":".-","ב":"-...","ג":"--.","ד":"-..","ה":"---","ו":".","ז":"--..","ח":"....","ט":"..-","י":"..","כ":"-.-","ל":".-..","מ":"--","נ":"-.","ס":"-.-.","ע":".---","פ":".--.","צ":".--","ק":"--.-","ר":".-.","ש":"...","ת":"-","ך":"-.-","ם":"--","ן":"-.","ף":".--.","ץ":".--","ا":".-","ب":"-...","ت":"-","ث":"-.-.","ج":".---","ح":"....","خ":"---","د":"-..","ذ":"--..","ر":".-.","ز":"---.","س":"...","ش":"----","ص":"-..-","ض":"...-","ط":"..-","ظ":"-.--","ع":".-.-","غ":" --.","ف":"..-.","ق":"--.-","ك":"-.-","ل":".-..","م":"--","ن":"-.","و":".--","ء":".","لا":".-...-","ﻕ":"--.-","ي":"..","ه":"..-.."," ":" "},a={".":1,"-":3," ":1};this.controls_options={wpm_min:5,wpm_max:50,eff_min:0,eff_max:50,ews_min:0,ews_max:5,freq_min:300,freq_max:1500,edge_min:1,edge_max:25,volume_min:0,volume_max:100},this.control_labels={},this.control_inputs={},this.wpm=20,this.eff=0,this.ews=0,this.freq=600,this.volume=.5,this.playvolume=1,this.q=10,this.dotlen,this.playLength=0,this.playEnd=0,this.playTiming=[],this.init_done=!1,this.text="",this.paused=!0,this.progressbar=!1,this.mode="audio",this.cgiurl="https://cgi2.lcwo.net/cgi-bin/",this.real=!1,this.vvv=!1,this.prefix="vvv = ",this.suffix=" +",this.textStart=0,this.textEnd=Number.MAX_VALUE,this.showSettings=!1,this.startDelay=0,this.prosign=!1,this.finishedTimeout=null;try{var e=parseFloat(localStorage.getItem("jscwlib_vol"));0<=e&&e<=1&&(this.playvolume=e)}catch(t){console.log("No volume in local storage.")}try{var i=parseFloat(localStorage.getItem("jscwlib_q"));0<=i&&i<=25&&(this.q=i)}catch(t){console.log("No Q in local storage.")}if(t)for(var n in t)this[n]=t[n];try{this.audioCtx=new(window.AudioContext||window.webkitAudioContext),console.log("AudioContext OK")}catch(t){this.mode="embed",console.log("AudioContext not supported. Fall back to HTML audio element")}this.init=function(){if("embed"==this.mode)this.player||(this.player=document.createElement("audio"),document.body.appendChild(this.player));else{this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioCtx.createGain(),this.gainNodePlay=this.audioCtx.createGain(),this.gainNodeLimiter=this.audioCtx.createGain(),this.oscillator=this.audioCtx.createOscillator(),this.biquadFilter=this.audioCtx.createBiquadFilter(),this.noiseFilterL=this.audioCtx.createBiquadFilter(),this.noiseFilterH=this.audioCtx.createBiquadFilter(),this.whiteNoise=this.audioCtx.createBufferSource(),this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=32768,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.noiseFilterL.type="lowpass",this.noiseFilterL.frequency.setValueAtTime(400,this.audioCtx.currentTime),this.noiseFilterL.Q.setValueAtTime(20,this.audioCtx.currentTime),this.noiseFilterH.type="highpass",this.noiseFilterH.frequency.setValueAtTime(700,this.audioCtx.currentTime),this.noiseFilterH.Q.setValueAtTime(20,this.audioCtx.currentTime);for(var t=2*this.audioCtx.sampleRate,e=this.audioCtx.createBuffer(1,t,this.audioCtx.sampleRate),i=e.getChannelData(0),s=0;s<t;s++)i[s]=.5*Math.random()-1;this.whiteNoise.buffer=e,this.whiteNoise.loop=!0,this.whiteNoise.connect(this.noiseFilterL),this.noiseFilterL.connect(this.noiseFilterH),this.noiseFilterH.connect(this.audioCtx.destination),this.biquadFilter.type="lowpass",this.biquadFilter.frequency.setValueAtTime(500,this.audioCtx.currentTime),this.biquadFilter.Q.setValueAtTime(this.q,this.audioCtx.currentTime),this.oscillator.type="sine",this.oscillator.frequency.setValueAtTime(600,this.audioCtx.currentTime),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.gainNodeLimiter),this.gainNodeLimiter.connect(this.biquadFilter),this.biquadFilter.connect(this.gainNodePlay),this.gainNodePlay.connect(this.analyser),this.analyser.connect(this.audioCtx.destination),this.gainNode.gain.value=0,this.gainNodePlay.gain.value=this.playvolume,this.gainNodeLimiter.gain.value=.55,this.oscillator.start(),this.setFreq(this.freq),this.setQ(this.q)}this.init_done=!0},this.getLength=function(){return"audio"==this.mode?this.playLength:this.player?this.player.duration:0},this.setFilter=function(t){console.log("setFilter f = "+t),this.biquadFilter.frequency.setValueAtTime(t,this.audioCtx.currentTime)},this.setQ=function(t){console.log("setQ = "+t);try{localStorage.setItem("jscwlib_q",t)}catch(t){console.log("localStorage not available. Not saving q.")}this.q=t,this.biquadFilter.Q.setValueAtTime(t,this.audioCtx.currentTime),this.gainNodeLimiter.gain.setValueAtTime(1.8*Math.exp(-.115*t),this.audioCtx.currentTime),this.updateControls()},this.setReal=function(t){console.log("setReal: "+t),this.real=!!t},this.getRemaining=function(){return this.init_done&&0<=(t="audio"==this.mode?this.playEnd-this.audioCtx.currentTime:this.player.duration-this.player.currentTime)?Math.round(10*t)/10:0;var t},this.getTime=function(){var t;return(t="audio"==this.mode?this.getLength()-this.getRemaining():this.player.currentTime)<0?0:t},this.getPlaytime=function(){return this.playLength},this.setWpm=function(t){console.log("setWpm = "+t),t=parseInt(t),this.wpm=t,"audio"==this.mode&&this.init_done&&(this.gainNode.gain.cancelScheduledValues(this.audioCtx.currentTime),this.gainNode.gain.setValueAtTime(0,this.audioCtx.currentTime)),this.updateControls()},this.setEff=function(t){console.log("setEff = "+t),"audio"==this.mode&&this.init_done&&(this.gainNode.gain.cancelScheduledValues(this.audioCtx.currentTime),this.gainNode.gain.setValueAtTime(0,this.audioCtx.currentTime)),t=parseInt(t),this.eff=t,this.updateControls()},this.setEws=function(t){console.log("setEws = "+t),t=parseFloat(t),this.ews=t,"audio"==this.mode&&this.init_done&&(this.gainNode.gain.cancelScheduledValues(this.audioCtx.currentTime),this.gainNode.gain.setValueAtTime(0,this.audioCtx.currentTime)),this.updateControls()},this.setFreq=function(t){console.log("setFreq: "+t),this.freq=t,"audio"==this.mode&&this.init_done&&(this.oscillator.frequency.setValueAtTime(t,this.audioCtx.currentTime),this.setFilter(t)),this.updateControls()},this.setVolume=function(t){this.playvolume=t;try{localStorage.setItem("jscwlib_vol",t)}catch(t){console.log("localStorage not available. Not saving volume")}this.updateControls(),"audio"==this.mode&&this.init_done&&this.gainNodePlay.gain.setValueAtTime(t,this.audioCtx.currentTime)},this.setStartDelay=function(t){console.log("setStartDelay = "+t),this.startDelay=t},this.setPrefix=function(t){this.prefix=t},this.setSuffix=function(t){this.suffix=t},this.enablePS=function(t){this.vvv=!!t},this.updateControls=function(){this.onParamChange&&(console.log("onParamChange"),this.onParamChange()),this.control_labels.wpm&&(this.control_labels.wpm.innerHTML=this.wpm+"&nbsp;WpM"),this.control_labels.eff&&(this.eff?this.control_labels.eff.innerHTML=this.eff+"&nbsp;WpM":this.control_labels.eff.innerHTML="&nbsp;(off)"),this.control_labels.ews&&(this.ews?this.control_labels.ews.innerHTML=this.ews+1+"&nbsp;&times;":this.control_labels.ews.innerHTML="&nbsp;(off)"),this.control_labels.freq&&(this.control_labels.freq.innerHTML=this.freq+"&nbsp;Hz"),this.control_labels.edge&&(this.control_labels.edge.innerHTML=this.q+"&nbsp;"),this.control_labels.vol&&(this.control_labels.vol.innerHTML=Math.round(100*this.playvolume)+"&nbsp;%"),this.refresh_download_link()},this.enableControls=function(t,e){for(var i in console.log("enableControls = "+e),t.control_inputs)"vol"!=i&&"edge"!=i&&"freq"!=i&&(t.control_inputs[i].disabled=!e)},this.oscilloscope=function(t){var e=t.getContext("2d"),i=t.width,s=t.height;this.analyser.getByteTimeDomainData(this.dataArray),e.fillStyle="rgb(200, 200, 200)",e.fillRect(0,0,i,s),e.lineWidth=2,e.strokeStyle="rgb(0, 0, 0)",e.beginPath();for(var n=+i/this.bufferLength,l=0,o=0;o<this.bufferLength;o++){var a=this.dataArray[o]/128*s/2;0===o?e.moveTo(l,a):e.lineTo(l,a),l+=n}e.lineTo(i,s/2),e.stroke()},this.draw=function(t){var e=t.getContext("2d"),i=t.width,t=t.height;if(e.fillStyle="#ffffff",e.fillRect(0,0,i,t),0!=this.playTiming.length){var s=this.playTiming[this.playTiming.length-1].t,n=(i-20)/s;e.save(),e.translate(10,t),e.scale(n,-1);for(var l=0;l<s;l++)e.lineWidth=1/n,0!=l&&l%60!=0||(e.lineWidth=5/n),e.beginPath(),e.moveTo(l,0),e.lineTo(l,9),e.stroke();if(s<10)for(l=0;l<s;l+=this.dotlen)e.beginPath(),e.moveTo(l,9),e.lineTo(l,19),e.stroke();e.fillStyle="#ff00ff";for(l=0;l<this.playTiming.length-1;l++)0<this.playTiming[l].v&&e.fillRect(this.playTiming[l].t,10,this.playTiming[l+1].t-this.playTiming[l].t,5);e.restore()}else e.fillText("Nothing to draw",0,10)},this.calcSpeed=function(){this.eff>this.wpm&&(this.eff=this.wpm);var t=this.eff;!this.real&&0!=this.eff||(t=this.wpm),this.dotlen=1.2/this.wpm,this.effdotlen=1.2/t;t=2.5-1.5/Math.pow(this.wpm/t,1.25);this.fwdotlen=this.effdotlen*t,this.letterspace=3*this.fwdotlen,this.wordspace=7*this.fwdotlen-this.letterspace},this.setText=function(t){t=t.replace(/\|W/g,"|z"),this.text=t.toLowerCase(),this.refresh_download_link()},this.setTextB64=function(t){try{t=atob(t),console.log("setText: Text is base64 encoded.")}catch(t){console.log("setText: Text is not base64 encoded.")}this.setText(t)},this.refresh_download_link=function(){this.btn_down&&(this.btn_down.href=this.cgiurl+"cw.mp3?d=001&s="+this.wpm+"&e="+this.eff+"&f="+this.freq+"&t=|W"+this.ews+" "+this.text.replace("|z","|W"),8e3<this.btn_down.href.length&&(console.log("Warning: Download URL truncated, requested URL was too long."),this.btn_down.href=this.btn_down.href.substr(0,8e3)))},this.play=function(t){this.init_done||this.init(),this.onPlay&&(console.log("OnPlay"),this.onPlay()),this.paused=!1;var e=t||this.text;if(this.text=e,"embed"==this.mode)return this.player.src=this.cgiurl+"cw.mp3?s="+this.wpm+"&e="+this.eff+"&f="+this.freq+"&t=|W"+this.ews+" "+e+"%20%20%20%20%5E",this.player.play(),void console.log(this.player);e=(e=e.replace(/\|W/g,"|z")).toLowerCase(),this.setText(e),this.vvv&&!this.real&&(e=this.prefix+e+this.suffix);var i,s=this.gen_morse_events(e);this.vvv&&this.real&&(this.real=!1,i=this.wpm,t=this.eff,this.wpm=s.paris,this.eff=s.paris,s=this.gen_morse_events(this.prefix+e+this.suffix),this.wpm=i,this.eff=t,this.real=!0,this.updateControls());var n=s.timings;if(n.length){var l=this.audioCtx.currentTime+.01;l+=n.length/1e4;for(var o=document.getElementById("lamp"),a=0;a<n.length;a++){var r=l+n[a].t;n[a].hasOwnProperty("c")&&this.setCharacterCb(n[a].c,1e3*n[a].t),n[a].hasOwnProperty("v")&&(this.gainNode.gain.setValueAtTime(n[a].v,r),o&&(0==n[a].v?setTimeout(function(){o.style.backgroundColor="white"},1e3*n[a].t):setTimeout(function(){o.style.backgroundColor="yellow"},1e3*n[a].t))),n[a].hasOwnProperty("f")&&(this.oscillator.frequency.setValueAtTime(n[a].f,r),this.biquadFilter.frequency.setValueAtTime(n[a].f,r))}this.playLength=n[n.length-1].t,this.playEnd=l+this.playLength,this.playTiming=n,this.onFinished&&(clearTimeout(this.finishedTimeout),this.finishedTimeout=setTimeout(this.onFinished,1e3*this.playLength))}},this.pause=function(){"running"===this.audioCtx.state?(this.paused=!0,this.audioCtx.suspend(),clearTimeout(this.finishedTimeout)):(this.paused=!1,this.audioCtx.resume(),this.finishedTimeout=setTimeout(this.onFinished,1e3*this.getRemaining())),console.log("paused: "+this.paused)},this.stop=function(){"audio"==this.mode?(this.gainNode.gain.cancelScheduledValues(this.audioCtx.currentTime),this.gainNode.gain.setValueAtTime(0,this.audioCtx.currentTime),this.playEnd=0,clearTimeout(this.finishedTimeout)):this.player.pause()},this.onCharacterPlay=function(t){},this.setCharacterCb=function(t,e){var i=this.onCharacterPlay;setTimeout(function(){i(t)},e)},this.gen_morse_timing=function(t,e){var i=[],s=o[t];s||(console.log("Don't know CW for character: '"+t+"', replacing with space."),s=" ");for(var n=0;n<s.length;n++){var l=s.substr(n,1);" "!=l&&i.push({t:e,v:this.volume}),e+=this.dotlen*a[l],i.push({t:e,v:0}),n<s.length-1&&(e+=this.dotlen)}return i.push({t:e,v:0}),i},this.gen_morse_events=function(t){var e=[],i=this.startDelay;this.textStart=i,this.textEnd=Number.MAX_VALUE,this.setFreq(this.freq),this.calcSpeed();for(var s=0,n=0;n<t.length;n++){var l,o=t.substr(n,1);if("|"==o){n++,o=t.substr(n,1),n++;var a=t.substr(n).split(" ");switch(n+=a[0].length,o){case"f":e=e.concat({t:i,f:a[0]}),console.log("Setting f = "+a[0]+" at "+i);break;case"w":1<a[0]&&(this.wpm=a[0],this.calcSpeed());break;case"e":this.eff=a[0],this.calcSpeed();break;case"z":this.ews=a[0],console.log("EWS = "+this.ews),this.calcSpeed();break;case"v":this.volume=parseFloat(a[0])/100;break;case"s":i+=a[0]/1e3}}else"<"==o?this.prosign=!0:">"==o?(this.prosign=!1,i+=2*this.dotlen):" "!=o?((l=this.gen_morse_timing(o,i))[0].c={n:n,c:o},l&&(i=(e=e.concat(l))[e.length-1].t,this.prosign?i+=this.dotlen:i+=this.letterspace,s++)):(i+=this.wordspace,this.ews&&(i+=(this.wordspace+this.letterspace)*this.ews));this.vvv&&n==this.prefix.length-1&&(this.textStart=i),(this.vvv&&n==t.length-this.suffix.length||!this.vvv&&n==t.length-1)&&(this.textEnd=i)}if(1==this.real){var r=e[e.length-1].t;console.log("Characters: "+s),console.log("Length: "+r);r=s/(r/60)/5;console.log("Real speed words/min: "+r);var h=this.wpm/r;console.log("mult "+h);for(n=0;n<e.length;n++)e[n].t=e[n].t/h;this.paris=this.wpm*h,this.textStart/=h,this.textEnd/=h}else this.paris=this.eff;return console.log("Equivalent PARIS speed = "+this.paris),{nc:s,paris:this.paris,length:i,timings:e}},this.setProgressbar=function(t,e){this.progressbar=t,this.progresslabel=e,window.setInterval(this.progressbarUpdate,100,this)},this.progressbarUpdate=function(t){if(t.progressbar){if("audio"==t.mode)t.progressbar.max=t.getLength(),t.progressbar.value=t.getLength()-t.getRemaining();else try{t.progressbar.max=t.player.duration,t.progressbar.value=t.player.currentTime}catch(t){return}var e=t.progressbar.value,i=0<=(e-=t.textStart)?"&nbsp;":"-",e=Math.abs(e);t.progresslabel.innerHTML=t.fmtTime(e,i)+" /"+t.fmtTime(t.getLength()-t.textStart,""),t.paused||0==t.getRemaining()?t.btn_pp.src!=m&&(t.btn_pp.src=m,t.enableControls(t,!0)):t.btn_pp.src!=s&&(t.btn_pp.src=s,t.enableControls(t,!1))}},this.fmtTime=function(t,e){for(var i=0;60<t;)i++,t-=60;return(t="-"==e?Math.ceil(t):Math.floor(t))<10&&(t="0"+t)," "+e+i+":"+t},this.renderPlayer=function(t,e){(t=document.getElementById(t)).innerHTML="",t.style.width="220px",t.style.padding="6px",t.style.margin="6px",t.style.fontFamily="Ubuntu,calibri,tahoma,arial,sans-serif";var i=document.createElement("progress");i.style.width="215px",i.style.height="15px",i.id="pb";var s=document.createElement("label");s.htmlFor="pb",s.innerHTML="0:00 ",s.style.fontSize="12px",s.style.fontWeight="normal",s.style.display="inline-block",e.setProgressbar(i,s);var n=document.createElement("img");n.src=m,n.title="Play / Pause",n.style.borderRadius="3px",n.style.backgroundColor="#dadada",n.style.cursor="pointer",n.style.border="1px solid #555555",n.style.textAlign="center",n.style.padding="0px 0px",n.style.margin="4px",n.style.display="inline-block",n.style.verticalAlign="middle",n.style.textDecoration="none",n.style.color="#000000",n.style.width="25px",n.style.height="25px",(e.btn_pp=n).onclick=function(){e.getRemaining()?e.pause():e.play()};var l=document.createElement("img");l.title=e.text,l.style.borderRadius="3px",l.style.backgroundColor="#dadada",l.style.cursor="pointer",l.style.border="1px solid #555555",l.style.textAlign="center",l.style.padding="0px 0px",l.style.margin="4px",l.style.display="inline-block",l.style.textDecoration="none",l.style.verticalAlign="middle",l.style.color="#000000",l.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNSIgaGVpZ2h0PSIyNSIgdmlld0JveD0iMCAwIDEwIDEwIj48cmVjdCB3aWR0aD0iMy43NSIgaGVpZ2h0PSIzLjc1IiB4PSIzLjEyNSIgeT0iMy4xMjUiIHJ5PSIwLjIiIHN0eWxlPSJmaWxsOiNmZmY7c3Ryb2tlLXdpZHRoOjAuMztzdHJva2U6IzAwMCIvPjwvc3ZnPgo=",l.title="Stop",l.style.width="25px",l.style.height="25px",l.onclick=function(){e.stop()};var o=document.createElement("a"),a=document.createElement("img");a.style.borderRadius="3px",a.style.backgroundColor="#dadada",a.style.cursor="pointer",a.style.border="1px solid #555555",a.style.textAlign="center",a.style.padding="0px 0px",a.style.margin="4px",a.style.display="inline-block",a.style.verticalAlign="middle",a.style.textDecoration="none",a.style.color="#000000",a.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4LjciIGhlaWdodD0iMTAiIHZpZXdCb3g9IjAgMCA4LjcgMTAiPjxwYXRoIHN0eWxlPSJzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6MC4yNnB4OyIgZD0ibSA0LjQsMi41IHYgNC43IGwgMS42LC0xLjYgdiAwLjMgbCAtMS42NywxLjY3IC0xLjY3LC0xLjY3IHYgLTAuMyBsIDEuNTYsMS42IDAsLTQuNyB6IiAvPjxwYXRoIHN0eWxlPSJzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6MC40OyIgZD0iTSAyLjUsOCBIIDYuMSIgLz48L3N2Zz4K",a.style.width="25px",a.style.height="25px",o.appendChild(a),o.title="Download MP3",(e.btn_down=o).onclick=function(){e.setText(e.text)};var r=document.createElement("a");r.style.position="relative",r.style.display="inline-block";var h=document.createElement("img");h.style.borderRadius="3px",h.style.backgroundColor="#dadada",h.style.cursor="pointer",h.style.border="1px solid #555555",h.style.textAlign="center",h.style.padding="0px 0px",h.style.margin="4px",h.style.display="inline-block",h.style.verticalAlign="middle",h.style.textDecoration="none",h.style.color="#000000",h.src=y,h.style.width="25px",h.style.height="25px",e.btn_set_img=h;var d=document.createElement("span");d.style.width="300px",d.style.color="#000000",d.style.backgroundColor="#eaeaea",d.style.borderRadius="6px",d.style.borderWidth="thin",d.style.borderStyle="solid",d.style.position="absolute",d.style.zIndex="1",d.style.top="30px",d.style.left="30px",d.style.padding="5px 5px",d.style.fontSize="12px",d.style.visibility="hidden",d.innerHTML="<b>Settings</b>",e.pop=d;var c=document.createElement("table"),u=document.createElement("input");u.id="speed",u.type="range",u.min=e.controls_options.wpm_min,u.max=e.controls_options.wpm_max,u.value=e.wpm,u.step=1,u.style.display="inline-block",u.style.verticalAlign="middle",u.style.width="150px",u.onchange=function(){e.setWpm(this.value)},u.oninput=function(){e.setWpm(this.value)};var g=document.createElement("label");g.htmlFor="speed",g.style.fontSize="12px",g.innerHTML="0 WpM",e.control_labels.wpm=g,e.control_inputs.wpm=u;var p=c.insertRow(),a=p.insertCell();a.appendChild(document.createTextNode("Speed:")),(a=p.insertCell()).appendChild(u),(a=p.insertCell()).appendChild(g);u=document.createElement("input");u.id="eff",u.type="range",u.min=e.controls_options.eff_min,u.max=e.controls_options.eff_max,u.value=e.eff,u.step=1,u.style.display="inline-block",u.style.verticalAlign="middle",u.style.width="150px",u.onchange=function(){e.setEff(this.value)},u.oninput=function(){e.setEff(this.value)};g=document.createElement("label");g.htmlFor="eff",g.style.fontSize="12px",g.innerHTML="0 WpM",e.control_labels.eff=g,e.control_inputs.eff=u,(a=(p=c.insertRow()).insertCell()).appendChild(document.createTextNode("eff. Speed:")),(a=p.insertCell()).appendChild(u),(a=p.insertCell()).appendChild(g);u=document.createElement("input");u.id="ews",u.type="range",u.min=e.controls_options.ews_min,u.max=e.controls_options.ews_max,u.value=e.ews,u.step=.1,u.style.display="inline-block",u.style.verticalAlign="middle",u.style.width="150px",u.onchange=function(){e.setEws(this.value)},u.oninput=function(){e.setEws(this.value)};g=document.createElement("label");g.htmlFor="ews",g.style.fontSize="12px",g.innerHTML="0",e.control_labels.ews=g,e.control_inputs.ews=u,(a=(p=c.insertRow()).insertCell()).appendChild(document.createTextNode("Word space:")),(a=p.insertCell()).appendChild(u),(a=p.insertCell()).appendChild(g);u=document.createElement("input");u.id="freq",u.type="range",u.min=e.controls_options.freq_min,u.max=e.controls_options.freq_max,u.value=e.freq,u.step=1,u.style.display="inline-block",u.style.verticalAlign="middle",u.style.width="150px",u.onchange=function(){e.setFreq(this.value)},u.oninput=function(){e.setFreq(this.value)};g=document.createElement("label");g.htmlFor="freq",g.style.fontSize="12px",g.innerHTML="600 Hz",e.control_labels.freq=g,e.control_inputs.freq=u,(a=(p=c.insertRow()).insertCell()).appendChild(document.createTextNode("Frequency:")),(a=p.insertCell()).appendChild(u),(a=p.insertCell()).appendChild(g);u=document.createElement("input");u.id="edge",u.type="range",u.min=e.controls_options.edge_min,u.max=e.controls_options.edge_max,u.value=e.edge,u.step=1,u.style.display="inline-block",u.style.verticalAlign="middle",u.style.width="150px",u.onchange=function(){e.setQ(this.value)},u.oninput=function(){e.setQ(this.value)};g=document.createElement("label");g.htmlFor="edge",g.style.fontSize="12px",g.innerHTML="10",e.control_labels.edge=g,e.control_inputs.edge=u,(a=(p=c.insertRow()).insertCell()).appendChild(document.createTextNode("Edge:")),(a=p.insertCell()).appendChild(u),(a=p.insertCell()).appendChild(g);u=document.createElement("input");u.id="vol",u.type="range",u.min=e.controls_options.volume_min,u.max=e.controls_options.volume_max,u.value=100*e.playvolume,u.step=1,u.style.display="inline-block",u.style.verticalAlign="middle",u.style.width="150px",u.onchange=function(){e.setVolume(this.value/100)},u.oninput=function(){e.setVolume(this.value/100)};g=document.createElement("label");g.htmlFor="vol",g.style.fontSize="12px",g.innerHTML="50%",e.control_labels.vol=g,e.control_inputs.vol=u,(a=(p=c.insertRow()).insertCell()).appendChild(document.createTextNode("Volume:")),(a=p.insertCell()).appendChild(u),(a=p.insertCell()).appendChild(g),this.help_url&&((a=(p=c.insertRow()).insertCell()).style.textAlign="end",a.colSpan=3,g=document.createElement("a"),p=document.createTextNode(this.help_text),g.style.fontSize="11px",g.href=this.help_url,g.appendChild(p),a.appendChild(g)),d.appendChild(c),r.appendChild(d),r.appendChild(h),r.title="Settings",e.btn_set=r,h.onclick=function(){e.toggle_settings()},e.updateControls(),t.appendChild(i),t.appendChild(l),t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(s),this.el=t},this.toggle_settings=function(){this.showSettings=!this.showSettings,this.showSettings?(console.log("show"),this.pop.style.visibility="visible",this.btn_set_img.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTYgMjU2IiB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiI+PHBhdGggZD0ibTEwNy43NSAyMi4xNTl2MjEuNTcxYy04LjgzNSAyLjExNy0xNy4yODYgNS42MDgtMjUuMDQgMTAuMzQ3bC0xNS4yMzQtMTUuMjM0LTI4LjYzMiAyOC42MzQgMTUuMjYgMTUuMjZjLTQuNzQ0OCA3Ljc0NDQtOC4yNDQzIDE2LjE4Ni0xMC4zNzEgMjUuMDE2aC0yMS41NzN2NDAuNDkzaDIxLjU3MWMyLjExNjEgOC44MzgyIDUuNjA3NiAxNy4yODkgMTAuMzQ3IDI1LjA0M2wtMTUuMjM0IDE1LjIzNCAyOC42MzIgMjguNjM0IDE1LjI2Mi0xNS4yNjJjNy43NDQ0IDQuNzQ0OCAxNi4xODYgOC4yNDQzIDI1LjAxNiAxMC4zNzF2MjEuNTczaDQwLjQ5M3YtMjEuNTcxYzguODM3NS0yLjExNjMgMTcuMjg4LTUuNjA3OCAyNS4wNDEtMTAuMzQ3bDE1LjIzNiAxNS4yMzYgMjguNjMyLTI4LjYzNC0xNS4yNi0xNS4yNmM0Ljc0NS03Ljc0NSA4LjI0NDUtMTYuMTg3IDEwLjM3MS0yNS4wMThoMjEuNTczdi00MC40OTNoLTIxLjU3MWMtMi4xMTYzLTguODM3NS01LjYwNzgtMTcuMjg4LTEwLjM0Ny0yNS4wNDFsMTUuMjUtMTUuMjIyLTI4LjY0LTI4LjYzNC0xNS4yNiAxNS4yNmMtNy43NDUtNC43NDUtMTYuMTg3LTguMjQ0NS0yNS4wMTgtMTAuMzcxdi0yMS41NzNoLTQwLjQ5M3ptMjAuMjQ3IDU3LjUzN2E0OC4zMDMgNDguMzAzIDAgMCAxIDQ4LjMgNDguMzA0IDQ4LjMwMyA0OC4zMDMgMCAwIDEgLTQ4LjMgNDguMyA0OC4zMDMgNDguMzAzIDAgMCAxIC00OC4zMDMgLTQ4LjMgNDguMzAzIDQ4LjMwMyAwIDAgMSA0OC4zMDMgLTQ4LjMwNHoiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjgiIC8+PC9zdmc+Cg=="):(console.log("hide"),this.btn_set_img.src=y,this.pop.style.visibility="hidden")}}